<link rel="import" href="../polymer/polymer-element.html">
<script src="typed.js"></script>
<link rel="import" href="animations.html">

<dom-module id="window-actor">
  <template>
    <style include="animation-styles">
      :host {
        display: block;
        margin: 20px;
      }

      .nocursor + .typed-cursor{
        opacity: 0 !important;
      }

      /* Keyframes for the fade-in */
      @-webkit-keyframes fadeInPrompt { from { opacity:0; } to { opacity:1; } }
      @-moz-keyframes fadeInPrompt { from { opacity:0; } to { opacity:1; } }
      @keyframes fadeInPrompt { from { opacity:0; } to { opacity:1; } }
      .promptAnimation {
        opacity:0;
        opacity: 1 \9; /*just in case ie*/
        -webkit-animation:fadeInPrompt ease-in 1;
        -moz-animation:fadeInPrompt ease-in 1;
        animation:fadeInPrompt ease-in 1;

        -webkit-animation-fill-mode:forwards;
        -moz-animation-fill-mode:forwards;
        animation-fill-mode:forwards;

        -webkit-animation-duration:0.1s;
        -moz-animation-duration:0.1s;
        animation-duration:0.1s;
      }

      /*
       * Actors
       */
      #window {
        border-radius: 5px;
        width: 300px;
        height: 200px;
        margin: 20px;
      }

      #title {
        width: 100%;
        text-align: center;
        font-weight: bold;
        color: #555;
      }

      #body {
        padding: 20px;
      }
  
      .hidden {
        display: none;
      }

      #file {
        width: 100px;
        height: 100px;
        background-color: red;
        display: block;
      }

      /*
       *
       * Different styles for the actors
       *
       */
      .terminal {
        background-color: black;
        color: white;              
      }

      .folder {
        background-color: #ccc;
        color: white;    
      }

      .spreadsheet {
        background-color: blue;
        color: white;    
      }

      .browserGithub {
        background-color: red;
        color: white;              
      }

      .browserForm {
        background-color: orange;
        color: white;              
      }

      .browserBlogPost {
        background-color: green;
        color: white;              
      }

      .browserBlogIndex {
        background-color: purple;
        color: white;              
      }

      /* 
       * Different styles fo the items
       */
      .terminal .items {
        font-weight: bold;
        margin-right: 10px;
        opacity: 0;
      }

      .terminal .items > * {
        display: inline-block;
        font-family: "Roboto Mono";
      }

    </style>

    <div id="file">
    </div>

    <div id="mouseCursor">
    </div>

    <div id="window" class$="window {{hidden}} {{cssClass}}">
      <div class="title">Folder</div>
      <div class="body">
        <div class="items"></div>
      </div>
    </div>

  </template>

  <script>
    class WindowActor extends Polymer.Element {
      static get is() { return 'window-actor'; }
      static get properties() {
        return {
          name: {
            type: String,
            value: 'Jekyll'
          },
          cssClass: {
            type: String
          },
          hidden: {
            type: String,
            value: ''
          }
        };        
      }

      show(args, done) {
        this.$.window.classList.remove('hidden');
        this.$.window.classList.add('animated');
        this.$.window.classList.add('slideInUp');    
        done();
      }

      setTitle(args, done) {
        this.$.title.innerHTML(args[0]);
        done();
      }

      setFilename(args, done) {
        this.$.filename.innerHTML(args[0]);
        done();
      }

      addFile(frame, done) {
        this.$.file.classList.remove('hidden');        
        this.$.file.classList.add('animated');
        this.$.file.classList.add('slideInLeft');
        done();
      }

      /*
       * Each window type has a container where we can add items that are styled
       * and animated appropriately for that particular container.
       */
      _addItem(item) {
        this.$.items.appendChild(item);
      }

      terminalInput(args, done) {
        var cli = document.createElement('div');
        cli.classList.add('cli');

        var prompt = document.createElement('span');
        prompt.classList.add('prompt');
        prompt.classList.add('promptAnimation');
        prompt.innerHTML = '$ ';
    
        var cmd = document.createElement('span');
        cmd.classList.add('cmd');

        cli.appendChild(prompt);
        cli.appendChild(cmd);

        this._addItem(cli);

        var typed = Typed.new(cmd, {
          strings: [frame.Text],
          typeSpeed: 2,
          startDelay: (0.1 + frame['Start Delay'].delay) * 1000,
          callback: function() {
            cmd.classList.add('nocursor');
            done(typed)
          }
        });
      }

    }

    window.customElements.define(WindowActor.is, WindowActor);
  </script>
</dom-module>
